{"version":3,"sources":["../../../src/server/router/singular.js"],"names":["express","require","write","getFullURL","module","exports","db","name","router","Router","show","req","res","next","locals","data","get","value","create","set","body","setHeader","location","status","update","method","assign","w","route","post","put","patch"],"mappings":";;AAAA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAMC,QAAQD,QAAQ,SAAR,CAAd;AACA,IAAME,aAAaF,QAAQ,gBAAR,CAAnB;;AAEAG,OAAOC,OAAP,GAAiB,UAACC,EAAD,EAAKC,IAAL,EAAc;AAC7B,MAAMC,SAASR,QAAQS,MAAR,EAAf;;AAEA,WAASC,IAAT,CAAcC,GAAd,EAAmBC,GAAnB,EAAwBC,IAAxB,EAA8B;AAC5BD,QAAIE,MAAJ,CAAWC,IAAX,GAAkBT,GAAGU,GAAH,CAAOT,IAAP,EAAaU,KAAb,EAAlB;AACAJ;AACD;;AAED,WAASK,MAAT,CAAgBP,GAAhB,EAAqBC,GAArB,EAA0BC,IAA1B,EAAgC;AAC9BP,OAAGa,GAAH,CAAOZ,IAAP,EAAaI,IAAIS,IAAjB,EAAuBH,KAAvB;AACAL,QAAIE,MAAJ,CAAWC,IAAX,GAAkBT,GAAGU,GAAH,CAAOT,IAAP,EAAaU,KAAb,EAAlB;;AAEAL,QAAIS,SAAJ,CAAc,+BAAd,EAA+C,UAA/C;AACAT,QAAIU,QAAJ,MAAgBnB,WAAWQ,GAAX,CAAhB;;AAEAC,QAAIW,MAAJ,CAAW,GAAX;AACAV;AACD;;AAED,WAASW,MAAT,CAAgBb,GAAhB,EAAqBC,GAArB,EAA0BC,IAA1B,EAAgC;AAC9B,QAAIF,IAAIc,MAAJ,KAAe,KAAnB,EAA0B;AACxBnB,SAAGa,GAAH,CAAOZ,IAAP,EAAaI,IAAIS,IAAjB,EACGH,KADH;AAED,KAHD,MAGO;AACLX,SAAGU,GAAH,CAAOT,IAAP,EACGmB,MADH,CACUf,IAAIS,IADd,EAEGH,KAFH;AAGD;;AAEDL,QAAIE,MAAJ,CAAWC,IAAX,GAAkBT,GAAGU,GAAH,CAAOT,IAAP,EAAaU,KAAb,EAAlB;AACAJ;AACD;;AAED,MAAMc,IAAIzB,MAAMI,EAAN,CAAV;;AAEAE,SAAOoB,KAAP,CAAa,GAAb,EACGZ,GADH,CACON,IADP,EAEGmB,IAFH,CAEQX,MAFR,EAEgBS,CAFhB,EAGGG,GAHH,CAGON,MAHP,EAGeG,CAHf,EAIGI,KAJH,CAISP,MAJT,EAIiBG,CAJjB;;AAMA,SAAOnB,MAAP;AACD,CA1CD","file":"singular.js","sourcesContent":["const express = require('express');\nconst write = require('./write');\nconst getFullURL = require('./get-full-url');\n\nmodule.exports = (db, name) => {\n  const router = express.Router();\n\n  function show(req, res, next) {\n    res.locals.data = db.get(name).value();\n    next();\n  }\n\n  function create(req, res, next) {\n    db.set(name, req.body).value();\n    res.locals.data = db.get(name).value();\n\n    res.setHeader('Access-Control-Expose-Headers', 'Location');\n    res.location(`${getFullURL(req)}`);\n\n    res.status(201);\n    next();\n  }\n\n  function update(req, res, next) {\n    if (req.method === 'PUT') {\n      db.set(name, req.body)\n        .value();\n    } else {\n      db.get(name)\n        .assign(req.body)\n        .value();\n    }\n\n    res.locals.data = db.get(name).value()\n    next()\n  }\n\n  const w = write(db);\n\n  router.route('/')\n    .get(show)\n    .post(create, w)\n    .put(update, w)\n    .patch(update, w);\n\n  return router;\n};\n"]}