{"version":3,"sources":["../../../src/server/router/nested.js"],"names":["express","require","pluralize","module","exports","router","Router","get","req","res","next","prop","singular","params","resource","query","id","url","nested","post","body"],"mappings":";;AAAA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAMC,YAAYD,QAAQ,WAAR,CAAlB;;AAEAE,OAAOC,OAAP,GAAiB,YAAM;AACrB,MAAMC,SAASL,QAAQM,MAAR,EAAf;;AAEA;AACA,WAASC,GAAT,CAAaC,GAAb,EAAkBC,GAAlB,EAAuBC,IAAvB,EAA6B;AAC3B,QAAMC,OAAOT,UAAUU,QAAV,CAAmBJ,IAAIK,MAAJ,CAAWC,QAA9B,CAAb;AACAN,QAAIO,KAAJ,CAAaJ,IAAb,WAAyBH,IAAIK,MAAJ,CAAWG,EAApC;AACAR,QAAIS,GAAJ,SAAcT,IAAIK,MAAJ,CAAWK,MAAzB;AACAR;AACD;;AAED;AACA,WAASS,IAAT,CAAcX,GAAd,EAAmBC,GAAnB,EAAwBC,IAAxB,EAA8B;AAC5B,QAAMC,OAAOT,UAAUU,QAAV,CAAmBJ,IAAIK,MAAJ,CAAWC,QAA9B,CAAb;AACAN,QAAIY,IAAJ,CAAYT,IAAZ,WAAwBH,IAAIK,MAAJ,CAAWG,EAAnC;AACAR,QAAIS,GAAJ,SAAcT,IAAIK,MAAJ,CAAWK,MAAzB;AACAR;AACD;;AAED,SAAOL,OACJE,GADI,CACA,wBADA,EAC0BA,GAD1B,EAEJY,IAFI,CAEC,wBAFD,EAE2BA,IAF3B,CAAP;AAGD,CAtBD","file":"nested.js","sourcesContent":["const express = require('express');\nconst pluralize = require('pluralize');\n\nmodule.exports = () => {\n  const router = express.Router();\n\n  // Rewrite URL (/:resource/:id/:nested -> /:nested) and request query\n  function get(req, res, next) {\n    const prop = pluralize.singular(req.params.resource);\n    req.query[`${prop}Id`] = req.params.id;\n    req.url = `/${req.params.nested}`;\n    next();\n  }\n\n  // Rewrite URL (/:resource/:id/:nested -> /:nested) and request body\n  function post(req, res, next) {\n    const prop = pluralize.singular(req.params.resource);\n    req.body[`${prop}Id`] = req.params.id;\n    req.url = `/${req.params.nested}`;\n    next();\n  }\n\n  return router\n    .get('/:resource/:id/:nested', get)\n    .post('/:resource/:id/:nested', post)\n};\n"]}